

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>4. Configure OpenStack &mdash; Deploying Cloud Foundry on Private Cloud 1 documentation</title>
  

  
  
  
  

  

  
  
    

  

  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/theme_overrides.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="5. Deploying CloudFoundry with BOSH Director on OpenStack" href="CFdeployment.html" />
    <link rel="prev" title="3. Install OpenStack" href="OpenStack.html" /> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> Deploying Cloud Foundry on Private Cloud
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="MAAS.html">1. Install MAAS</a></li>
<li class="toctree-l1"><a class="reference internal" href="Juju.html">2. Install Juju</a></li>
<li class="toctree-l1"><a class="reference internal" href="OpenStack.html">3. Install OpenStack</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">4. Configure OpenStack</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#environment-variables">4.1. Environment variables</a></li>
<li class="toctree-l2"><a class="reference internal" href="#define-an-external-network">4.2. Define an external network</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#define-an-external-network-using-web-ui">Define an external network using web UI:</a></li>
<li class="toctree-l3"><a class="reference internal" href="#define-an-external-network-using-cli">Define an external network using CLI:</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#working-with-flavors">4.3. Working with flavors</a></li>
<li class="toctree-l2"><a class="reference internal" href="#working-with-domains-and-projects">4.4. Working with domains and projects</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#working-with-domains-and-projects-using-web-ui">Working with domains and projects using web UI:</a></li>
<li class="toctree-l3"><a class="reference internal" href="#working-with-domains-and-projects-using-cli">Working with domains and projects using CLI:</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="CFdeployment.html">5. Deploying CloudFoundry with BOSH Director on OpenStack</a></li>
<li class="toctree-l1"><a class="reference internal" href="BOSH.html">6. Install BOSH</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Deploying Cloud Foundry on Private Cloud</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>4. Configure OpenStack</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/CFconfig.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="configure-openstack">
<span id="cf-config"></span><h1>4. Configure OpenStack<a class="headerlink" href="#configure-openstack" title="Permalink to this headline">¶</a></h1>
<p>In previous sections we’ve deployed OpenStack using both Juju and MAAS. The next step is to configure OpenStack for use within a production environment.</p>
<p>The steps te be followed are:</p>
<ul class="simple">
<li>Setting up the environment variables</li>
<li>Adding a domain, project and user</li>
<li>External network access and Ubuntu cloud image deployment</li>
</ul>
<div class="section" id="environment-variables">
<span id="cf-env-conf"></span><h2>4.1. Environment variables<a class="headerlink" href="#environment-variables" title="Permalink to this headline">¶</a></h2>
<p>When accessing OpenStack from the command line, specific environment variables need to be set:</p>
<ul class="simple">
<li>OS_AUTH_URL</li>
<li>OS_USER_DOMAIN_NAME</li>
<li>OS_USERNAME</li>
<li>OS_PROJECT_DOMAIN_NAME</li>
<li>OS_PROJECT_NAME</li>
<li>OS_PROJECT_NAME</li>
<li>OS_REGION_NAME</li>
<li>OS_IDENTITY_API_VERSION</li>
<li>OS_AUTH_VERSION</li>
</ul>
<p>The OS_AUTH_URL is the address of the OpenStack Keystone node for authentication. To retrieve this IP address by Juju use the following command (or as shown <a class="reference internal" href="OpenStack.html#openstack-test"><span class="std std-ref">here</span></a>):</p>
<div class="code highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">juju</span> <span class="n">status</span> <span class="o">--</span><span class="nb">format</span><span class="o">=</span><span class="n">yaml</span> <span class="n">keystone</span><span class="o">/</span><span class="mi">0</span> <span class="o">|</span> <span class="n">grep</span> <span class="n">public</span><span class="o">-</span><span class="n">address</span> <span class="o">|</span> <span class="n">awk</span> <span class="s1">&#39;{print $2}&#39;</span>
</pre></div>
</div>
<p>The specific environment variables are included in a file called <strong>openrc</strong>. It is located in <code class="docutils literal notranslate"><span class="pre">openstack_bundles/stable/openstack-base</span></code> or you can <a class="reference external" href="https://github.com/eniware-org/openstack-bundles/blob/master/stable/shared/openrcv3_project">download</a> it. It can easily be sourced (made active).</p>
<p>The <strong>openrc</strong> file contains the following:</p>
<div class="code highlight-default notranslate"><div class="highlight"><pre><span></span>_OS_PARAMS=$(env | awk &#39;BEGIN {FS=&quot;=&quot;} /^OS_/ {print $1;}&#39; | paste -sd &#39; &#39;)
for param in $_OS_PARAMS; do
    if [ &quot;$param&quot; = &quot;OS_AUTH_PROTOCOL&quot; ]; then continue; fi
    if [ &quot;$param&quot; = &quot;OS_CACERT&quot; ]; then continue; fi
    unset $param
done
unset _OS_PARAMS

_keystone_unit=$(juju status keystone --format yaml | \
    awk &#39;/units:$/ {getline; gsub(/:$/, &quot;&quot;); print $1}&#39;)
_keystone_ip=$(juju run --unit ${_keystone_unit} &#39;unit-get private-address&#39;)
_password=$(juju run --unit ${_keystone_unit} &#39;leader-get admin_passwd&#39;)

export OS_AUTH_URL=${OS_AUTH_PROTOCOL:-http}://${_keystone_ip}:5000/v3
export OS_USERNAME=admin
export OS_PASSWORD=${_password}
export OS_USER_DOMAIN_NAME=admin_domain
export OS_PROJECT_DOMAIN_NAME=admin_domain
export OS_PROJECT_NAME=admin
export OS_REGION_NAME=RegionOne
export OS_IDENTITY_API_VERSION=3
# Swift needs this:
export OS_AUTH_VERSION=3
# Gnocchi needs this
export OS_AUTH_TYPE=password
</pre></div>
</div>
<p>The environment variables can be enabled/sourced with the following command:</p>
<div class="code highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">source</span> <span class="n">openrc</span>
</pre></div>
</div>
<p>After the <strong>openrc</strong> is created, you can use OpenStack’s Horizon web UI to download the file, which automatically adjusts the environment variables. You should be loged with the given <em>username</em>. Right click on the <em>user</em> dropdown menu in the the upper right corner and select <strong>openrc -v3</strong> from the list.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If the <strong>openrc</strong> file is manually edited, it is important that all variables are correctly entered.</p>
</div>
<p>You can check the variables have been set correctly by seeing if your OpenStack endpoints are visible with the <code class="docutils literal notranslate"><span class="pre">openstack</span> <span class="pre">endpoint</span> <span class="pre">list</span></code> command. The output will look something like this:</p>
<div class="code highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">+----------------------------------+-----------+--------------+--------------+</span>
<span class="o">|</span> <span class="n">ID</span>                               <span class="o">|</span> <span class="n">Region</span>    <span class="o">|</span> <span class="n">Service</span> <span class="n">Name</span> <span class="o">|</span> <span class="n">Service</span> <span class="n">Type</span> <span class="o">|</span>
<span class="o">+----------------------------------+-----------+--------------+--------------+</span>
<span class="o">|</span> <span class="mi">060</span><span class="n">d704e582b4f9cb432e9ecbf3f679e</span> <span class="o">|</span> <span class="n">RegionOne</span> <span class="o">|</span> <span class="n">cinderv2</span>     <span class="o">|</span> <span class="n">volumev2</span>     <span class="o">|</span>
<span class="o">|</span> <span class="mi">269</span><span class="n">fe0ad800741c8b229a0b305d3ee23</span> <span class="o">|</span> <span class="n">RegionOne</span> <span class="o">|</span> <span class="n">neutron</span>      <span class="o">|</span> <span class="n">network</span>      <span class="o">|</span>
<span class="o">|</span> <span class="mi">3</span><span class="n">ee5114e04bb45d99f512216f15f9454</span> <span class="o">|</span> <span class="n">RegionOne</span> <span class="o">|</span> <span class="n">swift</span>        <span class="o">|</span> <span class="nb">object</span><span class="o">-</span><span class="n">store</span> <span class="o">|</span>
<span class="o">|</span> <span class="mi">68</span><span class="n">bc78eb83a94ac48e5b79893d0d8870</span> <span class="o">|</span> <span class="n">RegionOne</span> <span class="o">|</span> <span class="n">nova</span>         <span class="o">|</span> <span class="n">compute</span>      <span class="o">|</span>
<span class="o">|</span> <span class="mi">59</span><span class="n">c83d8484d54b358f3e4f75a21dda01</span> <span class="o">|</span> <span class="n">RegionOne</span> <span class="o">|</span> <span class="n">s3</span>           <span class="o">|</span> <span class="n">s3</span>           <span class="o">|</span>
<span class="o">|</span> <span class="n">bebd70c3f4e84d439aa05600b539095e</span> <span class="o">|</span> <span class="n">RegionOne</span> <span class="o">|</span> <span class="n">keystone</span>     <span class="o">|</span> <span class="n">identity</span>     <span class="o">|</span>
<span class="o">|</span> <span class="mi">1</span><span class="n">eb95d4141c6416c8e0d9d7a2eed534f</span> <span class="o">|</span> <span class="n">RegionOne</span> <span class="o">|</span> <span class="n">glance</span>       <span class="o">|</span> <span class="n">image</span>        <span class="o">|</span>
<span class="o">|</span> <span class="mi">8</span><span class="n">bd7f4472ced40b39a5b0ecce29df3a0</span> <span class="o">|</span> <span class="n">RegionOne</span> <span class="o">|</span> <span class="n">cinder</span>       <span class="o">|</span> <span class="n">volume</span>       <span class="o">|</span>
<span class="o">+----------------------------------+-----------+--------------+--------------+</span>
</pre></div>
</div>
<p>If the endpoints aren’t visible, it’s likely your environment variables aren’t configured correctly.</p>
<div class="admonition hint">
<p class="first admonition-title">Hint</p>
<p class="last">As with both MAAS and Juju, most OpenStack operations can be accomplished using either the command line or a web UI.</p>
</div>
</div>
<div class="section" id="define-an-external-network">
<span id="cf-net-conf"></span><h2>4.2. Define an external network<a class="headerlink" href="#define-an-external-network" title="Permalink to this headline">¶</a></h2>
<p>To allow OpenStack network access, it is necessary to enter external network settings.</p>
<p>You should be logged as an <em>user</em> <strong>admin</strong> in the OpenStack Dashboard Horizon.
To do this, you need to know the following:</p>
<ul class="simple">
<li>the IP address for OpenStack Dashboard</li>
<li>the user credential (<em>domain</em>, <em>user name</em> and <em>password</em>)</li>
</ul>
<div class="section" id="define-an-external-network-using-web-ui">
<span id="cf-net-conf-giu"></span><h3>Define an external network using web UI:<a class="headerlink" href="#define-an-external-network-using-web-ui" title="Permalink to this headline">¶</a></h3>
<p>Using the commands shown in section <a class="reference internal" href="OpenStack.html#openstack-test"><span class="std std-ref">“3.3. OpenStack testing”</span></a> log in to the Dashboard with the following:</p>
<ul class="simple">
<li>Dashboard IP address: <strong>192.168.40.145</strong></li>
<li>Domain: <strong>admin_domain</strong></li>
<li>User Name: <strong>admin</strong></li>
<li>Password: <strong>your_password</strong></li>
</ul>
<div class="figure align-center" id="cfconfig-horizon">
<img alt="Log in to Horizon dashboard" src="_images/4.1-cfconfig_horizon.png" />
</div>
<p>First step is to define a network called <strong>ext_net</strong>. It will use a subnet within the <a class="reference internal" href="MAAS.html#install-maas-dhcp1"><span class="std std-ref">range of addresses</span></a> reserved in MAAS.</p>
<p>From the panel on the left, click on <strong>Admin</strong> and choose section <strong>Network</strong>, subsection <strong>Networks</strong>. Then press the button <strong>+ Create Network</strong>:</p>
<div class="figure align-center" id="cfconfig-net-create">
<img alt="Create network" src="_images/4.2-cfconfig_net_create.png" />
</div>
<p>After opening the <strong>Create network</strong> window, you should enter the following settings:</p>
<ul class="simple">
<li>Name: <strong>ext_net</strong></li>
<li>Project: <strong>admin</strong></li>
<li>Network type: <strong>flat</strong></li>
<li>Phusical network: <strong>physnet1</strong></li>
<li>Marked checkboxes <strong>Enable Admin State</strong>, <strong>Shared</strong>, <strong>External Network</strong> and <strong>Create Subnet</strong></li>
</ul>
<div class="figure align-center" id="cfconfig-net-settings">
<img alt="External network settings" src="_images/4.3-cfconfig_net_settings.png" />
</div>
<p>The second step is to create a subnet for the network using the various addresses from our MAAS and Juju configuration:</p>
<ul class="simple">
<li>Subnet Name: <strong>ext_net_subnet</strong></li>
<li>Network address (the network address where OpenStack is deployed): <strong>192.168.40.0/24</strong></li>
<li>IP Version: <strong>IPv4</strong></li>
<li>Gateway IP: <strong>192.168.40.1</strong></li>
</ul>
<div class="figure align-center" id="cfconfig-net-subnet">
<img alt="Subnet settings" src="_images/4.4-cfconfig_net_subnet.png" />
</div>
<p>In the <strong>Subnet details</strong> tab it is important do unmark the <strong>Enable DHCP</strong> checkbox. An <strong>Allocation Pools</strong> should be defined (in format: <em>start_IP_address, end_IP_address</em>) as well as <strong>DNS Name Servers</strong> (on the first line: <em>the IP address of the MAAS server</em>, which in this case is <strong>192.168.40.16</strong> - see section <a class="reference internal" href="MAAS.html#maas-installation"><span class="std std-ref">“1.2. Installation”</span></a>), on the second line: <strong>the DNS uset to resolve domains not managed by MAAS</strong> which in this case is <strong>8.8.8.8</strong> - see section <a class="reference internal" href="MAAS.html#install-maas-services"><span class="std std-ref">“1.8. Network services”</span></a>):</p>
<div class="figure align-center" id="cfconfig-net-subdetails">
<img alt="Subnet settings" src="_images/4.5-cfconfig_net_subdetails.png" />
</div>
</div>
<div class="section" id="define-an-external-network-using-cli">
<span id="cf-net-conf-cli"></span><h3>Define an external network using CLI:<a class="headerlink" href="#define-an-external-network-using-cli" title="Permalink to this headline">¶</a></h3>
<p>To define a network called <strong>ext_net</strong> type the following command:</p>
<div class="code highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">openstack</span> <span class="n">network</span> <span class="n">create</span> <span class="n">ext_net</span> <span class="o">--</span><span class="n">share</span> <span class="o">--</span><span class="n">external</span>
</pre></div>
</div>
<p>The output from this command will show the various fields and values for the chosen configuration option. To show the new network ID alongside its name type the command <code class="docutils literal notranslate"><span class="pre">openstack</span> <span class="pre">network</span> <span class="pre">list</span></code>:</p>
<div class="code highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">+--------------------------------------+---------+---------+</span>
<span class="o">|</span> <span class="n">ID</span>                                   <span class="o">|</span> <span class="n">Name</span>    <span class="o">|</span> <span class="n">Subnets</span> <span class="o">|</span>
<span class="o">+--------------------------------------+---------+---------+</span>
<span class="o">|</span> <span class="n">fc171d22</span><span class="o">-</span><span class="n">d1b0</span><span class="o">-</span><span class="mi">467</span><span class="n">d</span><span class="o">-</span><span class="n">b6fa</span><span class="o">-</span><span class="mi">109</span><span class="n">dfb77787b</span> <span class="o">|</span> <span class="n">ext_net</span> <span class="o">|</span>         <span class="o">|</span>
<span class="o">+--------------------------------------+---------+---------+</span>
</pre></div>
</div>
<p>To create a subnet for the network using the various addresses from our MAAS and Juju configuration type the following command:</p>
<div class="code highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">openstack</span> <span class="n">subnet</span> <span class="n">create</span> <span class="n">ext_net_subnet</span> <span class="o">--</span><span class="n">allocation</span><span class="o">-</span><span class="n">pool</span> \
<span class="n">start</span><span class="o">=</span><span class="mf">192.168</span><span class="o">.</span><span class="mf">40.191</span><span class="p">,</span><span class="n">end</span><span class="o">=</span><span class="mf">192.168</span><span class="o">.</span><span class="mf">40.254</span> <span class="o">--</span><span class="n">subnet</span><span class="o">-</span><span class="nb">range</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">40.0</span><span class="o">/</span><span class="mi">24</span> \
<span class="o">--</span><span class="n">no</span><span class="o">-</span><span class="n">dhcp</span> <span class="o">--</span><span class="n">gateway</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">40.1</span> <span class="o">--</span><span class="n">dns</span><span class="o">-</span><span class="n">nameserver</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">40.16</span> \
<span class="o">--</span><span class="n">dns</span><span class="o">-</span><span class="n">nameserver</span> <span class="mf">8.8</span><span class="o">.</span><span class="mf">8.8</span> <span class="o">--</span><span class="n">network</span> <span class="n">ext_net</span>
</pre></div>
</div>
<p>The output from the previous command provides a comprehensive overview of the new subnet’s configuration:</p>
<div class="code highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">+-------------------------+--------------------------------------+</span>
<span class="o">|</span> <span class="n">Field</span>                   <span class="o">|</span> <span class="n">Value</span>                                <span class="o">|</span>
<span class="o">+-------------------------+--------------------------------------+</span>
<span class="o">|</span> <span class="n">allocation_pools</span>        <span class="o">|</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">40.191</span><span class="o">-</span><span class="mf">192.168</span><span class="o">.</span><span class="mf">40.254</span>        <span class="o">|</span>
<span class="o">|</span> <span class="n">cidr</span>                    <span class="o">|</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">40.0</span><span class="o">/</span><span class="mi">24</span>                      <span class="o">|</span>
<span class="o">|</span> <span class="n">created_at</span>              <span class="o">|</span> <span class="mi">2019</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">04</span><span class="n">T13</span><span class="p">:</span><span class="mi">43</span><span class="p">:</span><span class="mi">48</span>                  <span class="o">|</span>
<span class="o">|</span> <span class="n">description</span>             <span class="o">|</span>                                      <span class="o">|</span>
<span class="o">|</span> <span class="n">dns_nameservers</span>         <span class="o">|</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">40.16</span><span class="p">,</span> <span class="mf">8.8</span><span class="o">.</span><span class="mf">8.8</span>               <span class="o">|</span>
<span class="o">|</span> <span class="n">enable_dhcp</span>             <span class="o">|</span> <span class="kc">False</span>                                <span class="o">|</span>
<span class="o">|</span> <span class="n">gateway_ip</span>              <span class="o">|</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">40.1</span>                         <span class="o">|</span>
<span class="o">|</span> <span class="n">host_routes</span>             <span class="o">|</span>                                      <span class="o">|</span>
<span class="o">|</span> <span class="nb">id</span>                      <span class="o">|</span> <span class="mi">563</span><span class="n">ecd06</span><span class="o">-</span><span class="n">bbc3</span><span class="o">-</span><span class="mi">4</span><span class="n">c98</span><span class="o">-</span><span class="n">b93e</span>              <span class="o">|</span>
<span class="o">|</span> <span class="n">ip_version</span>              <span class="o">|</span> <span class="mi">4</span>                                    <span class="o">|</span>
<span class="o">|</span> <span class="n">ipv6_address_mode</span>       <span class="o">|</span> <span class="kc">None</span>                                 <span class="o">|</span>
<span class="o">|</span> <span class="n">ipv6_ra_mode</span>            <span class="o">|</span> <span class="kc">None</span>                                 <span class="o">|</span>
<span class="o">|</span> <span class="n">name</span>                    <span class="o">|</span> <span class="n">ext_net_subnet</span>                       <span class="o">|</span>
<span class="o">|</span> <span class="n">network_id</span>              <span class="o">|</span> <span class="n">fc171d22</span><span class="o">-</span><span class="n">d1b0</span><span class="o">-</span><span class="mi">467</span><span class="n">d</span><span class="o">-</span><span class="n">b6fa</span><span class="o">-</span><span class="mi">109</span><span class="n">dfb77787b</span> <span class="o">|</span>
<span class="o">|</span> <span class="n">project_id</span>              <span class="o">|</span> <span class="mi">4068710688184</span><span class="n">af997c1907137d67c76</span>     <span class="o">|</span>
<span class="o">|</span> <span class="n">revision_number</span>         <span class="o">|</span> <span class="kc">None</span>                                 <span class="o">|</span>
<span class="o">|</span> <span class="n">segment_id</span>              <span class="o">|</span> <span class="kc">None</span>                                 <span class="o">|</span>
<span class="o">|</span> <span class="n">service_types</span>           <span class="o">|</span> <span class="kc">None</span>                                 <span class="o">|</span>
<span class="o">|</span> <span class="n">subnetpool_id</span>           <span class="o">|</span> <span class="kc">None</span>                                 <span class="o">|</span>
<span class="o">|</span> <span class="n">updated_at</span>              <span class="o">|</span> <span class="mi">2019</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">04</span><span class="n">T13</span><span class="p">:</span><span class="mi">43</span><span class="p">:</span><span class="mi">48</span>                  <span class="o">|</span>
<span class="o">|</span> <span class="n">use_default_subnet_pool</span> <span class="o">|</span> <span class="kc">None</span>                                 <span class="o">|</span>
<span class="o">+-------------------------+--------------------------------------+</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">OpenStack has <a class="reference external" href="https://docs.openstack.org/python-neutronclient/latest/">deprecated</a> the use of the <strong>neutron</strong> command for network configuration, migrating most of its functionality into the Python OpenStack client. Version 2.4.0 or later of this client is needed for the <code class="docutils literal notranslate"><span class="pre">subnet</span> <span class="pre">create</span></code> command.</p>
</div>
</div>
</div>
<div class="section" id="working-with-flavors">
<span id="cf-domain-flavors"></span><h2>4.3. Working with flavors<a class="headerlink" href="#working-with-flavors" title="Permalink to this headline">¶</a></h2>
<p>The <strong>flavors</strong> define the compute, memory, and storage capacity of nova computing instances. A <strong>flavor</strong> is an available hardware configuration for a server. It defines the size of a virtual server that can be launched.
Admin users can use the <code class="docutils literal notranslate"><span class="pre">openstack</span> <span class="pre">flavor</span></code> command to <a class="reference external" href="https://docs.openstack.org/nova/rocky/admin/flavors.html">create, customize and manage flavor</a>.</p>
<div class="admonition hint">
<p class="first admonition-title">Hint</p>
<p class="last">For information on the flavors and flavor extra specs, refer to <a class="reference external" href="https://docs.openstack.org/nova/rocky/user/flavors.html">Flavors</a>.</p>
</div>
<p>To create a flavor using an <code class="docutils literal notranslate"><span class="pre">openstack</span> <span class="pre">flavor</span> <span class="pre">create</span></code> command, you should specify the following parameters:</p>
<ul class="simple">
<li>flavour name</li>
<li>ID</li>
<li>RAM size</li>
<li>disk size</li>
<li>the number of vCPUs for the flavor</li>
</ul>
<p>For the purpose of OpenStack configuration and CloudFoundry deployment, you need to create flavors with the following names and configuration:</p>
<div class="code highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">openstack</span> <span class="n">flavor</span> <span class="n">create</span> <span class="o">--</span><span class="n">vcpus</span> <span class="mi">1</span> <span class="o">--</span><span class="n">ram</span> <span class="mi">3840</span> <span class="o">--</span><span class="n">disk</span> <span class="mi">3</span> <span class="o">--</span><span class="n">ephemeral</span> <span class="mi">10</span> <span class="n">minimal</span>
<span class="n">openstack</span> <span class="n">flavor</span> <span class="n">create</span> <span class="o">--</span><span class="n">vcpus</span> <span class="mi">2</span> <span class="o">--</span><span class="n">ram</span> <span class="mi">7680</span> <span class="o">--</span><span class="n">disk</span> <span class="mi">3</span> <span class="o">--</span><span class="n">ephemeral</span> <span class="mi">14</span> <span class="n">small</span>
<span class="n">openstack</span> <span class="n">flavor</span> <span class="n">create</span> <span class="o">--</span><span class="n">vcpus</span> <span class="mi">2</span> <span class="o">--</span><span class="n">ram</span> <span class="mi">7680</span> <span class="o">--</span><span class="n">disk</span> <span class="mi">3</span> <span class="o">--</span><span class="n">ephemeral</span> <span class="mi">50</span> <span class="n">small</span><span class="o">-</span><span class="mi">50</span><span class="n">GB</span><span class="o">-</span><span class="n">ephemeral</span><span class="o">-</span><span class="n">disk</span>
<span class="n">openstack</span> <span class="n">flavor</span> <span class="n">create</span> <span class="o">--</span><span class="n">vcpus</span> <span class="mi">4</span> <span class="o">--</span><span class="n">ram</span> <span class="mi">31232</span> <span class="o">--</span><span class="n">disk</span> <span class="mi">3</span> <span class="o">--</span><span class="n">ephemeral</span> <span class="mi">10</span> <span class="n">small</span><span class="o">-</span><span class="n">highmem</span>
<span class="n">openstack</span> <span class="n">flavor</span> <span class="n">create</span> <span class="o">--</span><span class="n">vcpus</span> <span class="mi">4</span> <span class="o">--</span><span class="n">ram</span> <span class="mi">31232</span> <span class="o">--</span><span class="n">disk</span> <span class="mi">3</span> <span class="o">--</span><span class="n">ephemeral</span> <span class="mi">100</span> <span class="n">small</span><span class="o">-</span><span class="n">highmem</span><span class="o">-</span><span class="mi">100</span><span class="n">GB</span><span class="o">-</span><span class="n">ephemeral</span><span class="o">-</span><span class="n">disk</span>
<span class="n">openstack</span> <span class="n">flavor</span> <span class="n">create</span> <span class="o">--</span><span class="n">vcpus</span> <span class="mi">8</span> <span class="o">--</span><span class="n">ram</span> <span class="mi">16384</span> <span class="o">--</span><span class="n">disk</span> <span class="mi">160</span> <span class="o">--</span><span class="n">ephemeral</span> <span class="mi">0</span> <span class="n">m1</span><span class="o">.</span><span class="n">xlarge</span>
</pre></div>
</div>
<p>To list the created flavors and show the ID and name, the amount of memory, the amount of disk space for the root partition and for the ephemeral partition, the swap, and the number of virtual CPUs for each flavor, type the command:</p>
<div class="code highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">openstack</span> <span class="n">flavor</span> <span class="nb">list</span>
</pre></div>
</div>
<p>The following table lists the created flavors:</p>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="43%" />
<col width="11%" />
<col width="15%" />
<col width="15%" />
<col width="15%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><strong>Name</strong></td>
<td><strong>CPUs</strong></td>
<td><strong>RAM (MiB)</strong></td>
<td><strong>Root Disk (GiB)</strong></td>
<td><strong>Ephemeral Disk (GiB)</strong></td>
</tr>
<tr class="row-even"><td>minimal</td>
<td>1</td>
<td>3840</td>
<td>3</td>
<td>10</td>
</tr>
<tr class="row-odd"><td>small</td>
<td>2</td>
<td>7680</td>
<td>3</td>
<td>14</td>
</tr>
<tr class="row-even"><td>small-50GB-ephemeral-disk</td>
<td>2</td>
<td>7680</td>
<td>3</td>
<td>50</td>
</tr>
<tr class="row-odd"><td>small-highmem</td>
<td>4</td>
<td>31232</td>
<td>3</td>
<td>10</td>
</tr>
<tr class="row-even"><td>small-highmem-100GB-ephemeral-disk</td>
<td>4</td>
<td>31232</td>
<td>3</td>
<td>100</td>
</tr>
<tr class="row-odd"><td>m1.xlarge</td>
<td>8</td>
<td>16384</td>
<td>160</td>
<td>0</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="working-with-domains-and-projects">
<span id="cf-domain-conf"></span><h2>4.4. Working with domains and projects<a class="headerlink" href="#working-with-domains-and-projects" title="Permalink to this headline">¶</a></h2>
<p>The following is vital part of OpenStack operations:</p>
<ul class="simple">
<li><strong>Domains</strong> - abstract resources; a domain is a collection of users and projects that exist within the OpenStack environment.</li>
<li><strong>Projects</strong> - organizational units in the cloud to which you can assign users (a project is a group of zero or more users).</li>
<li><strong>users</strong> - members of one or more projects.</li>
<li><strong>roles</strong> - define which actions users can perform. You assign roles to user-project pairs.</li>
</ul>
<div class="section" id="working-with-domains-and-projects-using-web-ui">
<span id="cf-domain-conf-giu"></span><h3>Working with domains and projects using web UI:<a class="headerlink" href="#working-with-domains-and-projects-using-web-ui" title="Permalink to this headline">¶</a></h3>
<p>To create a <strong>domain</strong> using Dashboard, click on <strong>Identity</strong> from the panel on the left and choose section <strong>Domains</strong>. Then press the button <strong>+ Create Domain</strong>:</p>
<div class="figure align-center" id="cfconfig-domain-create">
<img alt="Create domain" src="_images/4.6-cfconfig_domain_create.png" />
</div>
<p>You need to create domain with name <strong>cf_domain</strong></p>
<p>After the <strong>cf_domain</strong> is created you need to locate it in the table with domains and press the corresponding bitton <strong>Set Domain Context</strong> from the <strong>Actions</strong> column. In this way, all subsequent operations will be executed in the context of this domain.</p>
<div class="figure align-center" id="cfconfig-domain-context">
<img alt="Set domain context" src="_images/4.7-cfconfig_domain_context.png" />
</div>
<p>To create a <strong>Project</strong> in the context of <strong>cf_domain</strong> domain click on <strong>Identity</strong> from the panel on the left and choose section <strong>Projects</strong>. Then press the button <strong>+ Create Project</strong> and enter the name <strong>cludfoundry</strong> for this new project:</p>
<div class="figure align-center" id="cfconfig-project-create">
<img alt="Create new project" src="_images/4.8-cfconfig_project_create.png" />
</div>
<p>To create a <strong>User</strong> with a <em>role</em> <strong>member</strong> of <strong>cludfoundry</strong> <em>project</em>, click on <strong>Identity</strong> from the panel on the left and choose section <strong>Users</strong>. Then press the button <strong>+ Create User</strong> and enter the name <strong>eniware</strong> for the <strong>User Name</strong>:</p>
<div class="figure align-center" id="cfconfig-user-create">
<img alt="Create new user" src="_images/4.9-cfconfig_user_create.png" />
</div>
<p>You should specify a <strong>password</strong> <em>your_password</em> for this user.</p>
<p>After the <strong>project</strong> and <strong>user</strong> are created, you should go back into <strong>Identity / Domains</strong> section and press the button <strong>Clear Domain Context</strong> to complete the execution of procedures in the context of <strong>cf_domain</strong>:</p>
<div class="figure align-center" id="cfconfig-domain-clctx">
<img alt="Clear domain context" src="_images/4.10-cfconfig_domain_clctx.png" />
</div>
<p>The finall step is to log out user <strong>admin_domain</strong> from the Dashboard.</p>
<p>Now you can log in to Dashboard with the created domain <strong>cf_domain</strong>:</p>
<ul class="simple">
<li>Domain: <strong>cf_domain</strong></li>
<li>User: <strong>eniware</strong></li>
<li>Password: <em>your_password</em></li>
</ul>
<div class="figure align-center" id="cfconfig-domain-cflogin">
<img alt="cf_domain log in" src="_images/4.11-cfconfig_domain_cflogin.png" />
</div>
</div>
<div class="section" id="working-with-domains-and-projects-using-cli">
<span id="cf-domain-conf-cli"></span><h3>Working with domains and projects using CLI:<a class="headerlink" href="#working-with-domains-and-projects-using-cli" title="Permalink to this headline">¶</a></h3>
<p>To create a single domain with a single project and single user for a new deployment, start with the <strong>domain</strong>:</p>
<div class="code highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">openstack</span> <span class="n">domain</span> <span class="n">create</span> <span class="n">cf_domain</span>
</pre></div>
</div>
<p>To add a <strong>project</strong> to the <strong>domain</strong>:</p>
<div class="code highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">openstack</span> <span class="n">project</span> <span class="n">create</span> <span class="o">--</span><span class="n">domain</span> <span class="n">cf_domain</span> \
    <span class="o">--</span><span class="n">description</span> <span class="s1">&#39;First Project&#39;</span> <span class="n">cf_domain</span>
</pre></div>
</div>
<p>To add a <strong>user</strong> and assign that user to the <strong>project</strong>:</p>
<div class="code highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">openstack</span> <span class="n">user</span> <span class="n">create</span> <span class="o">--</span><span class="n">domain</span> <span class="n">cf_domain</span> \
    <span class="o">--</span><span class="n">project</span><span class="o">-</span><span class="n">domain</span> <span class="n">cf_domain</span> <span class="o">--</span><span class="n">project</span> <span class="n">cloudfoundry</span> \
    <span class="o">--</span><span class="n">password</span><span class="o">-</span><span class="n">prompt</span> <span class="n">cf_domain</span>
</pre></div>
</div>
<p>The output to the previous command will be similar to the following:</p>
<div class="code highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">+---------------------+----------------------------------+</span>
<span class="o">|</span> <span class="n">Field</span>               <span class="o">|</span> <span class="n">Value</span>                            <span class="o">|</span>
<span class="o">+---------------------+----------------------------------+</span>
<span class="o">|</span> <span class="n">default_project_id</span>  <span class="o">|</span> <span class="mf">914e59223944433</span><span class="n">dbf12417ac4cd4031</span> <span class="o">|</span>
<span class="o">|</span> <span class="n">domain_id</span>           <span class="o">|</span> <span class="mf">7993528e51344814</span><span class="n">be2fd53f1f8f82f9</span> <span class="o">|</span>
<span class="o">|</span> <span class="n">enabled</span>             <span class="o">|</span> <span class="kc">True</span>                             <span class="o">|</span>
<span class="o">|</span> <span class="nb">id</span>                  <span class="o">|</span> <span class="n">e980be28b20b4a2190c41ae478942ab1</span> <span class="o">|</span>
<span class="o">|</span> <span class="n">name</span>                <span class="o">|</span> <span class="n">cf_domain</span>                        <span class="o">|</span>
<span class="o">|</span> <span class="n">options</span>             <span class="o">|</span> <span class="p">{}</span>                               <span class="o">|</span>
<span class="o">|</span> <span class="n">password_expires_at</span> <span class="o">|</span> <span class="kc">None</span>                             <span class="o">|</span>
<span class="o">+---------------------+----------------------------------+</span>
</pre></div>
</div>
<p>Every subsequent action will now be performed by <strong>eniware</strong> user within the new <strong>cf_project</strong> project.</p>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="CFdeployment.html" class="btn btn-neutral float-right" title="5. Deploying CloudFoundry with BOSH Director on OpenStack" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="OpenStack.html" class="btn btn-neutral" title="3. Install OpenStack" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018, EniWARE.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'1',
            LANGUAGE:'None',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>

  

  <script type="text/javascript" src="_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>